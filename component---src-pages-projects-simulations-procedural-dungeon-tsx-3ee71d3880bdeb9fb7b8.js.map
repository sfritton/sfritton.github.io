{"version":3,"sources":["webpack:///./src/simulations/procedural-dungeon/util.ts","webpack:///./src/simulations/procedural-dungeon/constants.ts","webpack:///./src/simulations/procedural-dungeon/Room.ts","webpack:///./src/simulations/procedural-dungeon/ProceduralDungeon.ts","webpack:///./src/simulations/procedural-dungeon/index.ts","webpack:///./src/components/Button/index.tsx","webpack:///./src/pages/projects/simulations/procedural-dungeon.tsx","webpack:///./src/components/Button/button.module.css","webpack:///./src/pages/projects/simulations/dungeon.module.css","webpack:///./src/simulations/util/helpers.ts"],"names":["randomMiddle","min","max","randomFromTo","Room","p5","x1","x2","y1","y2","exits","level","maxLevel","onPath","hasKey","isDungeonEntrance","isDungeonExit","this","render","strokeWeight","stroke","fill","beginShape","vertex","endShape","renderText","forEach","exit","noStroke","textSize","textAlign","CENTER","translate","rotate","PI","text","resetMatrix","isNeighbor","other","UNIT","findExits","candidates","length","candidate","entrance","Math","random","door","Door","push","exitLevel","to","findDungeonExit","findMaxLevelDescendent","maxChild","findPath","nextEntrance","from","findNonPathExit","maxLevelExit","findPathExit","find","placeKey","room","i","floor","nonPathExit","undefined","pathExit","isLocked","isVertical","a1","a2","a","line","x","y","ProceduralDungeon","generateDungeon","rooms","divide","dungeonEntrance","slice","dungeonExit","numKeys","renderDungeon","background","depth","results","width","height","isEven","middleX","middleY","Simulation","proceduralDungeon","buttonRef","dungeon","setup","current","addEventListener","e","preventDefault","Button","forwardRef","ref","children","props","type","className","styles","button","ProceduralDungeonPage","useRef","Layout","title","legend","swatch","style","src","sketch","module","exports"],"mappings":"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","file":"component---src-pages-projects-simulations-procedural-dungeon-tsx-3ee71d3880bdeb9fb7b8.js","sourcesContent":["import { randomFromTo } from '../util/helpers';\nimport { MULTIPLIER } from './constants';\n\nexport const randomMiddle = (min: number, max: number) =>\n  min + (max - min) * (0.5 + randomFromTo(-MULTIPLIER, MULTIPLIER));\n","export const UNIT = 8;\nexport const DEPTH = 5;\nexport const MULTIPLIER = 0.25;\nexport const MIN_WALL_LENGTH = UNIT * 6;\nexport const DOOR_HALF_WIDTH = UNIT * 1.5;\nexport const SHOW_PATH = false;\nexport const SHOW_LEVELS = false;\n\nexport const COLOR_ROOM = '#004466';\nexport const COLOR_WALL = '#00ccff';\nexport const COLOR_ENTRANCE = '#0066aa';\nexport const COLOR_EXIT = '#002244';\nexport const COLOR_PATH = '#e1d2ff';\n","import P5 from 'p5';\nimport {\n  COLOR_ENTRANCE,\n  COLOR_EXIT,\n  COLOR_PATH,\n  COLOR_ROOM,\n  COLOR_WALL,\n  DOOR_HALF_WIDTH,\n  MIN_WALL_LENGTH,\n  SHOW_LEVELS,\n  SHOW_PATH,\n  UNIT,\n} from './constants';\nimport { Direction } from './types';\nimport { randomFromTo } from '../util/helpers';\n\nexport class Room {\n  x1 = 0;\n  x2 = 0;\n  y1 = 0;\n  y2 = 0;\n  exits: Door[] = [];\n  entrance?: Door;\n  level = 0;\n  maxLevel = 0;\n  onPath = false;\n  hasKey = false;\n  isDungeonEntrance = false;\n  isDungeonExit = false;\n  p5: P5;\n\n  constructor(p5: P5, x1: number, x2: number, y1: number, y2: number) {\n    this.p5 = p5;\n    this.x1 = x1;\n    this.x2 = x2;\n    this.y1 = y1;\n    this.y2 = y2;\n  }\n\n  render() {\n    this.p5.strokeWeight(1.5);\n    this.p5.stroke(COLOR_WALL);\n    if (this.isDungeonEntrance) {\n      this.p5.fill(COLOR_ENTRANCE);\n    } else if (this.isDungeonExit) {\n      this.p5.fill(COLOR_EXIT);\n    } else if (SHOW_PATH && this.onPath) {\n      this.p5.fill(COLOR_PATH);\n    } else {\n      this.p5.fill(COLOR_ROOM);\n    }\n\n    this.p5.beginShape();\n    this.p5.vertex(this.x1, this.y1);\n    this.p5.vertex(this.x2, this.y1);\n    this.p5.vertex(this.x2, this.y2);\n    this.p5.vertex(this.x1, this.y2);\n    this.p5.vertex(this.x1, this.y1);\n    this.p5.endShape();\n\n    this.renderText();\n\n    this.exits.forEach((exit) => exit.render());\n  }\n\n  renderText() {\n    this.p5.noStroke();\n    if (!SHOW_LEVELS && !this.hasKey) return;\n\n    this.p5.fill(COLOR_WALL);\n\n    this.p5.textSize(19);\n    this.p5.textAlign(this.p5.CENTER, this.p5.CENTER);\n\n    if (this.hasKey) {\n      this.p5.translate(this.x1 + (this.x2 - this.x1) / 2, this.y1 + (this.y2 - this.y1) / 2);\n      this.p5.rotate((this.p5.PI * 3) / 4);\n      this.p5.text('F', 1, -5);\n      this.p5.text('O', -1, 7);\n      this.p5.resetMatrix();\n    } else {\n      this.p5.text(\n        this.level,\n        this.x1 + (this.x2 - this.x1) / 2,\n        this.y1 + (this.y2 - this.y1) / 2,\n      );\n    }\n  }\n\n  isNeighbor(other: Room): Direction | undefined {\n    // north\n    if (\n      this.y1 === other.y2 + UNIT &&\n      other.x2 - this.x1 > MIN_WALL_LENGTH &&\n      this.x2 - other.x1 > MIN_WALL_LENGTH\n    )\n      return 'north';\n\n    // east\n    if (\n      this.x2 === other.x1 - UNIT &&\n      other.y2 - this.y1 > MIN_WALL_LENGTH &&\n      this.y2 - other.y1 > MIN_WALL_LENGTH\n    )\n      return 'east';\n\n    // south\n    if (\n      this.y2 === other.y1 - UNIT &&\n      other.x2 - this.x1 > MIN_WALL_LENGTH &&\n      this.x2 - other.x1 > MIN_WALL_LENGTH\n    )\n      return 'south';\n\n    // west\n    if (\n      this.x1 === other.x2 + UNIT &&\n      other.y2 - this.y1 > MIN_WALL_LENGTH &&\n      this.y2 - other.y1 > MIN_WALL_LENGTH\n    )\n      return 'west';\n\n    return undefined;\n  }\n\n  findExits(candidates: Room[]) {\n    if (candidates.length === 0) return this.level;\n\n    candidates.forEach((candidate) => {\n      const direction = this.isNeighbor(candidate);\n\n      // ignore non-neighbors and rooms that have already been claimed\n      // ignore 15% of valid connections\n      if (!direction || candidate.entrance || Math.random() > 0.85) {\n        return;\n      }\n\n      const door = new Door(this.p5, this, candidate);\n      this.exits.push(door);\n      candidate.entrance = door;\n      candidate.level = this.level + 1;\n    });\n\n    this.maxLevel = this.level;\n\n    this.exits.forEach((exit) => {\n      const exitLevel = exit.to.findExits(candidates);\n      if (exitLevel > this.maxLevel) this.maxLevel = exitLevel;\n    });\n\n    return this.maxLevel;\n  }\n\n  findDungeonExit() {\n    if (!this.isDungeonEntrance) return;\n\n    const exit = this.findMaxLevelDescendent();\n    exit.isDungeonExit = true;\n    return exit;\n  }\n\n  findMaxLevelDescendent(): Room {\n    if (this.exits.length === 0) return this;\n\n    let maxChild = this.exits[0].to;\n\n    this.exits.forEach((exit) => {\n      const candidate = exit.to;\n\n      if (candidate.maxLevel > maxChild.maxLevel) maxChild = candidate;\n    });\n\n    return maxChild.findMaxLevelDescendent();\n  }\n\n  findPath() {\n    if (!this.isDungeonExit) return;\n\n    let nextEntrance = this.entrance;\n\n    while (nextEntrance) {\n      nextEntrance.onPath = true;\n      nextEntrance.from.onPath = true;\n\n      nextEntrance = nextEntrance.from.entrance;\n    }\n  }\n\n  findNonPathExit() {\n    let maxLevelExit: Door | undefined;\n\n    this.exits.forEach((exit) => {\n      if (exit.onPath) return;\n\n      if (!maxLevelExit || exit.to.maxLevel > maxLevelExit.to.maxLevel) {\n        maxLevelExit = exit;\n      }\n    });\n\n    return maxLevelExit;\n  }\n\n  findPathExit() {\n    return this.exits.find((exit) => exit.onPath);\n  }\n\n  /** Returns `true` if a key was successfully placed, `false` otherwise. */\n  placeKey() {\n    if (!this.isDungeonExit) return false;\n\n    const distance = Math.floor(randomFromTo(1, this.level));\n\n    let room: Room | undefined = this;\n\n    // walk up the tree for distance levels\n    for (let i = distance; i > 0 && room?.entrance; i--) {\n      room = room?.entrance?.from;\n    }\n\n    let nonPathExit: Door | undefined = undefined;\n\n    while (!nonPathExit) {\n      nonPathExit = room?.findNonPathExit();\n\n      if (!nonPathExit) {\n        if (!room?.entrance) return false;\n\n        // walk up another level\n        room = room.entrance.from;\n      }\n    }\n\n    // place the lock\n    const pathExit = room?.findPathExit();\n\n    if (!pathExit) return false;\n\n    pathExit.isLocked = true;\n\n    const keyRoom = nonPathExit.to.findMaxLevelDescendent();\n\n    // place the key\n    keyRoom.hasKey = true;\n\n    return true;\n  }\n}\n\nexport class Door {\n  from: Room;\n  to: Room;\n  onPath = false;\n  isLocked = false;\n  isVertical = false;\n  p5: P5;\n  x1!: number;\n  x2!: number;\n  y1!: number;\n  y2!: number;\n\n  constructor(p5: P5, from: Room, to: Room) {\n    this.p5 = p5;\n    this.from = from;\n    this.to = to;\n\n    const direction = from.isNeighbor(to);\n\n    // use the direction to set isVertical and the secondary axis\n    switch (direction) {\n      case 'north':\n        this.isVertical = false;\n        this.y1 = from.y1 - UNIT;\n        this.y2 = from.y1;\n        break;\n      case 'east':\n        this.isVertical = true;\n        this.x1 = from.x2;\n        this.x2 = from.x2 + UNIT;\n        break;\n      case 'south':\n        this.isVertical = false;\n        this.y1 = from.y2;\n        this.y2 = from.y2 + UNIT;\n        break;\n      case 'west':\n        this.isVertical = true;\n        this.x1 = from.x1 - UNIT;\n        this.x2 = from.x1;\n        break;\n    }\n\n    if (this.isVertical) {\n      const a1 = Math.max(from.y1, to.y1);\n      const a2 = Math.min(from.y2, to.y2);\n      const a =\n        Math.floor(randomFromTo(a1 + DOOR_HALF_WIDTH + UNIT, a2 - DOOR_HALF_WIDTH - UNIT) / UNIT) *\n        UNIT;\n\n      this.y1 = a - DOOR_HALF_WIDTH;\n      this.y2 = a + DOOR_HALF_WIDTH;\n    } else {\n      const a1 = Math.max(from.x1, to.x1);\n      const a2 = Math.min(from.x2, to.x2);\n      const a =\n        Math.floor(randomFromTo(a1 + DOOR_HALF_WIDTH + UNIT, a2 - DOOR_HALF_WIDTH - UNIT) / UNIT) *\n        UNIT;\n      this.x1 = a - DOOR_HALF_WIDTH;\n      this.x2 = a + DOOR_HALF_WIDTH;\n    }\n  }\n\n  render() {\n    // render rooms before doors\n    this.to.render();\n\n    // render a break in the wall\n    this.p5.noStroke();\n    this.p5.fill(COLOR_ROOM);\n    if (this.isVertical) {\n      this.p5.beginShape();\n      this.p5.vertex(this.x1 - 2, this.y1);\n      this.p5.vertex(this.x2 + 2, this.y1);\n      this.p5.vertex(this.x2 + 2, this.y2);\n      this.p5.vertex(this.x1 - 2, this.y2);\n      this.p5.endShape();\n    } else {\n      this.p5.beginShape();\n      this.p5.vertex(this.x1, this.y1 - 2);\n      this.p5.vertex(this.x2, this.y1 - 2);\n      this.p5.vertex(this.x2, this.y2 + 2);\n      this.p5.vertex(this.x1, this.y2 + 2);\n      this.p5.endShape();\n    }\n\n    // render the edges of the wall\n    this.p5.stroke(COLOR_WALL);\n    this.p5.strokeWeight(1.5);\n    if (this.isVertical) {\n      this.p5.line(this.x1, this.y1, this.x2, this.y1);\n      this.p5.line(this.x1, this.y2, this.x2, this.y2);\n    } else {\n      this.p5.line(this.x1, this.y1, this.x1, this.y2);\n      this.p5.line(this.x2, this.y1, this.x2, this.y2);\n    }\n\n    if (!this.isLocked) return;\n\n    // render the locked door\n    this.p5.stroke(COLOR_WALL);\n    this.p5.strokeWeight(UNIT / 2);\n    if (this.isVertical) {\n      const x = (this.x1 + this.x2) / 2;\n      this.p5.line(x, this.y1 + 2, x, this.y2 - 2);\n    } else {\n      const y = (this.y1 + this.y2) / 2;\n      this.p5.line(this.x1 + 2, y, this.x2 - 2, y);\n    }\n  }\n}\n","import P5 from 'p5';\nimport { UNIT, MIN_WALL_LENGTH, DEPTH } from './constants';\nimport { randomFromTo } from '../util/helpers';\nimport { randomMiddle } from './util';\nimport { Room } from './Room';\nimport { Simulation } from '../util/Simulation';\n\nexport class ProceduralDungeon extends Simulation {\n  dungeonEntrance?: Room;\n  dungeonExit?: Room;\n  maxLevel = 0;\n\n  generateDungeon() {\n    // divide the canvas into rooms\n    const rooms = this.divide(DEPTH);\n\n    this.dungeonEntrance = rooms[0];\n    this.dungeonEntrance.isDungeonEntrance = true;\n\n    // connect those rooms with doors, storing the longest path\n    this.maxLevel = this.dungeonEntrance.findExits(rooms.slice(1));\n\n    // choose an exit\n    this.dungeonExit = this.dungeonEntrance.findDungeonExit();\n\n    // find the path from the entrance to the exit\n    this.dungeonExit?.findPath();\n\n    const numKeys = Math.floor(randomFromTo(1, 4));\n\n    // place locks on doors along the path\n    for (let i = 0; i < numKeys; i++) {\n      this.dungeonExit?.placeKey();\n    }\n  }\n\n  renderDungeon() {\n    this.p5.noStroke();\n    this.p5.background(0);\n    this.dungeonEntrance?.render();\n  }\n\n  divide(depth: number, room?: Room, results?: Room[]): Room[] {\n    if (!room || !results) {\n      return this.divide(\n        depth,\n        new Room(this.p5, UNIT, this.p5.width - UNIT, UNIT, this.p5.height - UNIT),\n        [],\n      );\n    }\n\n    if (depth === 0) {\n      return [...results, room];\n    }\n\n    const flip = Math.random() > 0.85; // 15% of the time, break from the normal pattern\n    const isEven = depth % 2 === 0;\n    const isVertical = flip ? isEven : !isEven;\n\n    if (isVertical) {\n      const middleX = randomMiddle(room.x1, room.x2);\n\n      if (room.x2 - (middleX + UNIT) < MIN_WALL_LENGTH || middleX - room.x1 < MIN_WALL_LENGTH) {\n        return this.divide(depth - 1, room, results);\n      }\n\n      return [\n        ...this.divide(depth - 1, new Room(this.p5, room.x1, middleX, room.y1, room.y2), results),\n        ...this.divide(\n          depth - 1,\n          new Room(this.p5, middleX + UNIT, room.x2, room.y1, room.y2),\n          results,\n        ),\n      ];\n    }\n\n    const middleY = randomMiddle(room.y1, room.y2);\n\n    if (room.y2 - (middleY + UNIT) < MIN_WALL_LENGTH || middleY - room.y1 < MIN_WALL_LENGTH) {\n      return this.divide(depth - 1, room, results);\n    }\n\n    return [\n      ...this.divide(depth - 1, new Room(this.p5, room.x1, room.x2, room.y1, middleY), results),\n      ...this.divide(\n        depth - 1,\n        new Room(this.p5, room.x1, room.x2, middleY + UNIT, room.y2),\n        results,\n      ),\n    ];\n  }\n}\n","import { RefObject } from 'react';\nimport P5 from 'p5';\nimport { ProceduralDungeon } from './ProceduralDungeon';\n\nexport const proceduralDungeon = (buttonRef: RefObject<HTMLButtonElement>) => (p5: P5) => {\n  const dungeon = new ProceduralDungeon(p5);\n\n  p5.setup = function () {\n    dungeon.setup();\n    dungeon.generateDungeon();\n    dungeon.renderDungeon();\n  };\n\n  // TODO: there's got to be a better way to do this\n  buttonRef.current?.addEventListener('click', (e) => {\n    e.preventDefault();\n\n    dungeon.generateDungeon();\n    dungeon.renderDungeon();\n  });\n};\n","import React, { forwardRef } from 'react';\nimport styles from './button.module.css';\n\nexport const Button = forwardRef<HTMLButtonElement, React.ButtonHTMLAttributes<HTMLButtonElement>>(\n  ({ children, ...props }, ref) => {\n    return (\n      <button ref={ref} type=\"button\" {...props} className={styles.button}>\n        {children}\n      </button>\n    );\n  },\n);\n","import React, { useRef } from 'react';\nimport { PageProps } from 'gatsby';\nimport Layout from '../../../components/Layout';\nimport { Simulation } from '../../../components/Simulation';\nimport { proceduralDungeon } from '../../../simulations/procedural-dungeon';\nimport { COLOR_ENTRANCE, COLOR_EXIT } from '../../../simulations/procedural-dungeon/constants';\nimport styles from './dungeon.module.css';\nimport { Button } from '../../../components/Button';\n\nconst ProceduralDungeonPage: React.FC<PageProps> = () => {\n  const buttonRef = useRef<HTMLButtonElement>(null);\n\n  return (\n    <Layout title=\"Dungeon Generator\">\n      <h1>Dungeon Generator</h1>\n      <div>\n        A dungeon created using procedural generation. Start from the light blue room and try to\n        navigate to the dark blue room. If a locked door blocks your path, find a key to open it.\n      </div>\n      <div className={styles.legend}>\n        <div>\n          <span className={styles.swatch} style={{ background: COLOR_ENTRANCE }} /> Entrance\n        </div>\n        <div>\n          <span className={styles.swatch} style={{ background: COLOR_EXIT }} /> Exit\n        </div>\n        <div>\n          <img className={styles.swatch} src=\"/images/dungeon_lock.png\" /> Locked door\n        </div>\n        <div>\n          <img className={styles.swatch} src=\"/images/dungeon_key.png\" /> Key\n        </div>\n      </div>\n      <h2>Demo</h2>\n      <Simulation sketch={proceduralDungeon(buttonRef)} />\n      <Button ref={buttonRef}>Generate a new dungeon</Button>\n      <h2>How it works</h2>\n      <h3>Generating rooms</h3>\n      The algorithm starts with a single large room. It chooses a random point and adds a wall to\n      split the room into two new rooms. It repeats this process with each room until the dungeon is\n      sufficiently complex.\n      <div className={styles.rooms}>\n        <img src=\"/images/dungeon_0.png\" />\n        <img src=\"/images/dungeon_1.png\" />\n        <img src=\"/images/dungeon_2.png\" />\n        <img src=\"/images/dungeon_3.png\" />\n      </div>\n      <h3>Adding doors</h3>\n      Next, the algorithm chooses a room to be the entrance. It creates a door to each neighbor at a\n      random point along the shared wall. For each newly connected room, the process is repeated.\n      The result is a tree structure of rooms starting from the dungeon entrance.\n      <h3>Choosing an exit</h3>\n      The dungeon exit is chosen to be the room at the greatest depth, that is the furthest number\n      of doors from the dungeon entrance. There is only one path from the entrance to the exit.\n      <h3>Placing keys &amp; locks</h3>\n      The dungeon will have between one and four locked doors, each along the direct path from the\n      entrance to the exit. For each locked door, a key is placed in a room further up the tree.\n    </Layout>\n  );\n};\n\nexport default ProceduralDungeonPage;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"button-module--button--1AP7e\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"legend\":\"dungeon-module--legend--2XZJ5\",\"swatch\":\"dungeon-module--swatch--3B54k\",\"rooms\":\"dungeon-module--rooms--2XZ_V\"};","export const randomFromTo = (min: number, max: number) => (max - min) * Math.random() + min;\n"],"sourceRoot":""}